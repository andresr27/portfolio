---
- name: Obtener IP de VM a aprovisionar de vapp_params.ini
  hosts: local
  gather_facts: no
  vars_files:
    - vars/centos7_vars/vault.yml
  tasks:

    - name: "Obtener IP de VM a aprovisionar de config/vapp_params.ini"
      add_host:
        name: "{{ vm_ip }}"
        groups: VMCentos7 
        ansible_connection: ssh
        ansible_ssh_user: "{{ vm_user }}"
        ansible_ssh_pass: "{{ vm_pass }}"
        ansible_sudo_pass: "{{ vm_pass }}"

- name: Aprovisionar Centos 7 Base
  hosts: VMCentos7
  gather_facts: no
  pre_tasks:
    - name: Esperar por puerto 22
      local_action:
        module: wait_for
        host: "{{ inventory_hostname }}"
        search_regex: OpenSSH
        port: 22
        timeout: 300
      become: no
  roles:
    - os-update
    - zabbix-agent
    - filebeat
    - ossec

